<!-- Scripts pour Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

<style>
    .chart-container {
        position: relative;
        height: 300px;
        margin: 20px 0;
    }
    
    .chart-container.large {
        height: 400px;
    }
    
    .chart-container.small {
        height: 200px;
    }
    
    .metrics-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .metrics-card.success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .metrics-card.warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .metrics-card.info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .metrics-card.danger {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 0;
    }
    
    .metric-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin: 0;
    }
    
    .metric-icon {
        font-size: 3rem;
        opacity: 0.3;
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
    }
    
    .chart-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #495057;
    }
    
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .status-active {
        background-color: #d4edda;
        color: #155724;
    }
    
    .status-inactive {
        background-color: #f8d7da;
        color: #721c24;
    }
    
    .status-voting {
        background-color: #d1ecf1;
        color: #0c5460;
    }
</style>

<!-- Fonctions JavaScript communes pour les graphiques -->
<script>
    // Configuration globale pour Chart.js
    Chart.defaults.font.family = '"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
    Chart.defaults.color = '#6c757d';
    Chart.defaults.plugins.legend.position = 'top';
    Chart.defaults.plugins.legend.align = 'start';
    
    // Couleurs prédéfinies
    const chartColors = {
        primary: '#4e73df',
        success: '#1cc88a',
        info: '#36b9cc',
        warning: '#f6c23e',
        danger: '#e74a3b',
        secondary: '#858796',
        light: '#f8f9fc',
        dark: '#5a5c69'
    };
    
    const chartColorsPalette = [
        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',
        '#858796', '#6f42c1', '#fd7e14', '#20c997', '#17a2b8'
    ];
    
    /**
     * Crée un graphique en barres
     */
    function createBarChart(canvasId, data, options = {}) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        
        const defaultOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                },
                title: {
                    display: !!options.title,
                    text: options.title || '',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        };
        
        return new Chart(ctx, {
            type: 'bar',
            data: data,
            options: { ...defaultOptions, ...options }
        });
    }
    
    /**
     * Crée un graphique en secteurs (pie chart)
     */
    function createPieChart(canvasId, data, options = {}) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        
        const defaultOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'right'
                },
                title: {
                    display: !!options.title,
                    text: options.title || '',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                }
            }
        };
        
        return new Chart(ctx, {
            type: 'pie',
            data: data,
            options: { ...defaultOptions, ...options }
        });
    }
    
    /**
     * Crée un graphique en ligne
     */
    function createLineChart(canvasId, data, options = {}) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        
        const defaultOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                },
                title: {
                    display: !!options.title,
                    text: options.title || '',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        };
        
        return new Chart(ctx, {
            type: 'line',
            data: data,
            options: { ...defaultOptions, ...options }
        });
    }
    
    /**
     * Crée un graphique en donut
     */
    function createDonutChart(canvasId, data, options = {}) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        
        const defaultOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                },
                title: {
                    display: !!options.title,
                    text: options.title || '',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                }
            },
            cutout: '60%'
        };
        
        return new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: { ...defaultOptions, ...options }
        });
    }
    
    /**
     * Prépare les données pour un graphique à partir d'un tableau d'objets
     */
    function prepareChartData(dataArray, labelKey, valueKey, backgroundColors = chartColorsPalette) {
        return {
            labels: dataArray.map(item => item[labelKey]),
            datasets: [{
                data: dataArray.map(item => item[valueKey]),
                backgroundColor: backgroundColors.slice(0, dataArray.length),
                borderColor: backgroundColors.slice(0, dataArray.length),
                borderWidth: 1
            }]
        };
    }
    
    /**
     * Prépare les données pour un graphique multi-datasets
     */
    function prepareMultiDatasetChart(dataArray, labelKey, datasets) {
        return {
            labels: dataArray.map(item => item[labelKey]),
            datasets: datasets.map((dataset, index) => ({
                label: dataset.label,
                data: dataArray.map(item => item[dataset.key]),
                backgroundColor: dataset.backgroundColor || chartColorsPalette[index],
                borderColor: dataset.borderColor || chartColorsPalette[index],
                borderWidth: 1
            }))
        };
    }
    
    /**
     * Anime les compteurs numériques
     */
    function animateCounter(element, start, end, duration = 1000) {
        const startTime = Date.now();
        const range = end - start;
        
        function updateCounter() {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const current = Math.floor(start + (range * progress));
            
            element.textContent = current.toLocaleString();
            
            if (progress < 1) {
                requestAnimationFrame(updateCounter);
            }
        }
        
        updateCounter();
    }
    
    /**
     * Initialise l'animation des compteurs au chargement de la page
     */
    function initCounterAnimations() {
        const counters = document.querySelectorAll('.metric-value[data-count]');
        counters.forEach(counter => {
            const target = parseInt(counter.getAttribute('data-count'));
            animateCounter(counter, 0, target);
        });
    }
    
    // Initialiser les animations au chargement
    document.addEventListener('DOMContentLoaded', function() {
        initCounterAnimations();
    });
</script>
